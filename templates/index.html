<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>PyRobot Web UI</title>
    <style type="text/css">
      body { font-size: small; }
      table.sensors {
        border: 0px;
        border-collapse: collapse;
        padding: 0px;
        margin: 0px;
        font-size: 0.7em;
        width: 30em;
      }
      table.sensors tr:hover { background-color: #ddd; }
      table.sensors th { text-align: left; }
     }
    </style>
    <script type="text/javascript" src="/static/MochiKit/MochiKit.js"></script>
    <script type="text/javascript">
      buildTableFromObj = function(obj) {
        var rows = [];
        for (attr in obj) {
          rows.push([attr, obj[attr]]);
        }
        rows.sort(function(a, b) { return ((a[0] < b[0]) ? -1 : 1); });
        row_display = function (row) {
          return TR({'id': row[0]}, map(partial(TD, null), row));
        }
        var newTable = TABLE({'id': 'sensors', 'class': 'sensors'},
          TH(null, 'Sensor'),
          TH(null, 'Value'),
          TBODY(null, map(row_display, rows)));
        return newTable
      }

      updateSensorData = function(last_sensor_data) {
        var d = MochiKit.Async.loadJSONDoc('/sensors');
        d.addCallback(function(r) {
          new_sensor_table = buildTableFromObj(r);
          sensor_table = getElement('sensors');
          if (!sensor_table) {
            doc = currentDocument();
            MochiKit.DOM.appendChildNodes(doc.body, new_sensor_table);
          } else {
            MochiKit.DOM.swapDOM(sensor_table, new_sensor_table);
          }
          for (attr in r) {
            if (r[attr] != last_sensor_data[attr]) {
              MochiKit.Visual.Highlight(attr);
            }
          }
          MochiKit.Async.callLater(30, updateSensorData, r);
        });
        d.addErrback(function(e) {
          MochiKit.Async.callLater(5, updateSensorData, {'error': e});
        });
      }
      
      MochiKit.Signal.connect(window, 'onload', updateSensorData);
    </script>
  </head>
  <body>
    <img id="webcam" src="http://damonkohler.dnsalias.net:8081">
    <br>
    <a href="#"
      onclick="javascript:MochiKit.Async.loadJSONDoc('/forward');
        return false;">Forward</a> |
    <a href="#"
       onclick="javascript:MochiKit.Async.loadJSONDoc('/reverse');
         return false;">Reverse</a> |
    <a href="#"
       onclick="javascript:MochiKit.Async.loadJSONDoc('/left');
         return false;">Left</a> |
    <a href="#"
       onclick="javascript:MochiKit.Async.loadJSONDoc('/right');
         return false;">Right</a> |
    <a href="#"
       onclick="javascript:MochiKit.Async.loadJSONDoc('/dock');
         return false;">Dock</a> |
    <a href="#"
       onclick="javascript:MochiKit.Async.loadJSONDoc('/reset');
         return false;">Reset</a>
    <br><br>
  </body>
</html>
